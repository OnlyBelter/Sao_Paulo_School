<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Multispecies GLV: assembly and invasibility | A Tour of the Generalized Lotka-Volterra Model</title>
  <meta name="description" content="Lectures for the ICTP-SAIFR/IFT-UNESP School on Community Ecology: from patterns to principles" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Multispecies GLV: assembly and invasibility | A Tour of the Generalized Lotka-Volterra Model" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Lectures for the ICTP-SAIFR/IFT-UNESP School on Community Ecology: from patterns to principles" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Multispecies GLV: assembly and invasibility | A Tour of the Generalized Lotka-Volterra Model" />
  
  <meta name="twitter:description" content="Lectures for the ICTP-SAIFR/IFT-UNESP School on Community Ecology: from patterns to principles" />
  

<meta name="author" content="Stefano Allesina" />


<meta name="date" content="2020-01-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="games.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Lectures on Lotka-Volterra</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i><b>1.1</b> Prerequisites</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#sources"><i class="fa fa-check"></i><b>1.2</b> Sources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Generalized Lotka-Volterra</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#history"><i class="fa fa-check"></i><b>2.1</b> History</a><ul>
<li class="chapter" data-level="2.1.1" data-path="intro.html"><a href="intro.html#lotka-volterra-interactions"><i class="fa fa-check"></i><b>2.1.1</b> Lotka-Volterra interactions</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#basic-formulation"><i class="fa fa-check"></i><b>2.2</b> Basic formulation</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#a-single-population"><i class="fa fa-check"></i><b>2.3</b> A single population</a><ul>
<li class="chapter" data-level="2.3.1" data-path="intro.html"><a href="intro.html#metapopulation-dynamics"><i class="fa fa-check"></i><b>2.3.1</b> Metapopulation dynamics</a></li>
<li class="chapter" data-level="2.3.2" data-path="intro.html"><a href="intro.html#s-i-s-model"><i class="fa fa-check"></i><b>2.3.2</b> S-I-S model</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#multi-species-dynamics"><i class="fa fa-check"></i><b>2.4</b> Multi-species dynamics</a><ul>
<li class="chapter" data-level="2.4.1" data-path="intro.html"><a href="intro.html#existence-of-an-equilibrium"><i class="fa fa-check"></i><b>2.4.1</b> Existence of an equilibrium</a></li>
<li class="chapter" data-level="2.4.2" data-path="intro.html"><a href="intro.html#stability-of-an-equilibrium"><i class="fa fa-check"></i><b>2.4.2</b> Stability of an equilibrium</a></li>
<li class="chapter" data-level="2.4.3" data-path="intro.html"><a href="intro.html#types-of-dynamics"><i class="fa fa-check"></i><b>2.4.3</b> Types of dynamics</a></li>
<li class="chapter" data-level="2.4.4" data-path="intro.html"><a href="intro.html#the-equilibrium-is-the-time-average"><i class="fa fa-check"></i><b>2.4.4</b> The equilibrium is the time-average</a></li>
<li class="chapter" data-level="2.4.5" data-path="intro.html"><a href="intro.html#lyapunov-diagonal-stability-and-global-stability"><i class="fa fa-check"></i><b>2.4.5</b> Lyapunov diagonal stability and global stability</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#stability-of-large-random-communities"><i class="fa fa-check"></i><b>2.5</b> Stability of large random communities</a></li>
<li class="chapter" data-level="2.6" data-path="intro.html"><a href="intro.html#further-readings"><i class="fa fa-check"></i><b>2.6</b> Further readings</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="multi.html"><a href="multi.html"><i class="fa fa-check"></i><b>3</b> Multispecies GLV: assembly and invasibility</a><ul>
<li class="chapter" data-level="3.1" data-path="multi.html"><a href="multi.html#assembly"><i class="fa fa-check"></i><b>3.1</b> Assembly</a></li>
<li class="chapter" data-level="3.2" data-path="multi.html"><a href="multi.html#invasion-in-multispecies-communities"><i class="fa fa-check"></i><b>3.2</b> Invasion in multispecies communities</a></li>
<li class="chapter" data-level="3.3" data-path="multi.html"><a href="multi.html#lyapunov-stability-and-saturated-equilibria"><i class="fa fa-check"></i><b>3.3</b> Lyapunov stability and saturated equilibria</a></li>
<li class="chapter" data-level="3.4" data-path="multi.html"><a href="multi.html#how-many-species-will-coexist"><i class="fa fa-check"></i><b>3.4</b> How many species will coexist?</a><ul>
<li class="chapter" data-level="3.4.1" data-path="multi.html"><a href="multi.html#a-trivial-case"><i class="fa fa-check"></i><b>3.4.1</b> A trivial case</a></li>
<li class="chapter" data-level="3.4.2" data-path="multi.html"><a href="multi.html#simulating-final-composition"><i class="fa fa-check"></i><b>3.4.2</b> Simulating final composition</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="multi.html"><a href="multi.html#a-random-zoo"><i class="fa fa-check"></i><b>3.5</b> A random zoo</a></li>
<li class="chapter" data-level="3.6" data-path="multi.html"><a href="multi.html#assembly-and-saturated-equilibrium"><i class="fa fa-check"></i><b>3.6</b> Assembly and saturated equilibrium</a></li>
<li class="chapter" data-level="3.7" data-path="multi.html"><a href="multi.html#network-spandrels"><i class="fa fa-check"></i><b>3.7</b> Network spandrels</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="games.html"><a href="games.html"><i class="fa fa-check"></i><b>4</b> Evolutionary Game Theory</a><ul>
<li class="chapter" data-level="4.1" data-path="games.html"><a href="games.html#game-theory"><i class="fa fa-check"></i><b>4.1</b> Game theory</a></li>
<li class="chapter" data-level="4.2" data-path="games.html"><a href="games.html#two-player-matrix-games"><i class="fa fa-check"></i><b>4.2</b> Two-player matrix games</a><ul>
<li class="chapter" data-level="4.2.1" data-path="games.html"><a href="games.html#example-the-prisoners-dilemma"><i class="fa fa-check"></i><b>4.2.1</b> Example: the prisoner’s dilemma</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="games.html"><a href="games.html#mixed-strategies"><i class="fa fa-check"></i><b>4.3</b> Mixed strategies</a></li>
<li class="chapter" data-level="4.4" data-path="games.html"><a href="games.html#nash-equilibria"><i class="fa fa-check"></i><b>4.4</b> Nash Equilibria</a></li>
<li class="chapter" data-level="4.5" data-path="games.html"><a href="games.html#evolutionary-stable-strategies"><i class="fa fa-check"></i><b>4.5</b> Evolutionary stable strategies</a></li>
<li class="chapter" data-level="4.6" data-path="games.html"><a href="games.html#replicator-dynamics"><i class="fa fa-check"></i><b>4.6</b> Replicator dynamics</a><ul>
<li class="chapter" data-level="4.6.1" data-path="games.html"><a href="games.html#invariants"><i class="fa fa-check"></i><b>4.6.1</b> Invariants</a></li>
<li class="chapter" data-level="4.6.2" data-path="games.html"><a href="games.html#rock-paper-scissor"><i class="fa fa-check"></i><b>4.6.2</b> Rock-paper-scissor</a></li>
<li class="chapter" data-level="4.6.3" data-path="games.html"><a href="games.html#equivalence-with-glv"><i class="fa fa-check"></i><b>4.6.3</b> Equivalence with GLV</a></li>
<li class="chapter" data-level="4.6.4" data-path="games.html"><a href="games.html#hypertournament-games"><i class="fa fa-check"></i><b>4.6.4</b> Hypertournament games</a></li>
<li class="chapter" data-level="4.6.5" data-path="games.html"><a href="games.html#lyapunov-function"><i class="fa fa-check"></i><b>4.6.5</b> Lyapunov function</a></li>
<li class="chapter" data-level="4.6.6" data-path="games.html"><a href="games.html#higher-order-interactions"><i class="fa fa-check"></i><b>4.6.6</b> Higher-order interactions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>5</b> Simple models for synthetic communities</a><ul>
<li class="chapter" data-level="5.1" data-path="data.html"><a href="data.html#synthetic-communities-using-the-glv-model"><i class="fa fa-check"></i><b>5.1</b> Synthetic communities using the GLV model</a></li>
<li class="chapter" data-level="5.2" data-path="data.html"><a href="data.html#total-biomass"><i class="fa fa-check"></i><b>5.2</b> Total biomass</a></li>
<li class="chapter" data-level="5.3" data-path="data.html"><a href="data.html#hyperplanes"><i class="fa fa-check"></i><b>5.3</b> Hyperplanes</a></li>
<li class="chapter" data-level="5.4" data-path="data.html"><a href="data.html#fitting-real-data"><i class="fa fa-check"></i><b>5.4</b> Fitting real data</a></li>
<li class="chapter" data-level="5.5" data-path="data.html"><a href="data.html#predicting-real-data-out-of-fit"><i class="fa fa-check"></i><b>5.5</b> Predicting real data out of fit</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Tour of the Generalized Lotka-Volterra Model</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multi" class="section level1">
<h1><span class="header-section-number">3</span> Multispecies GLV: assembly and invasibility</h1>
<p>We have seen in the previous lecture that a large ecological community will almost invariably be unstable, possibly leading to extinctions. It is therefore natural to ask what happens when either a feasible equilibrium does not exist, or it is unstable. In particular, we want to know how many species can persist.</p>
<div id="assembly" class="section level2">
<h2><span class="header-section-number">3.1</span> Assembly</h2>
<p>We call <strong>assembly the process by which a community is constituted by adding species sequentially</strong>. Imagine starting with a bare environment, and introducing the first species. If the species can grow in the new environment, it will establish, and if not, it will go extinct. Mathematically, we assume that <strong>new species are introduced at very low abundance</strong>, so that they do not experience self-limitation due to crowding, and that <strong>invasion are spaced in time</strong> so that the dynamics can play out before the next invasion happens. For example, consider the first species entering the system, and write the equation for the per-capita growth rate:</p>
<p><span class="math display">\[
\dfrac{1}{x_i(t)}\dfrac{dx_i(t)}{dt} = r_i + A_{ii} x_i(t)
\]</span>
If <span class="math inline">\(x_i(0) \ll 1\)</span>, we can set <span class="math inline">\(A_{ii} x_i(0) \approx 0\)</span>, obtaining</p>
<p><span class="math display">\[
\dfrac{1}{x_i(t)}\dfrac{dx_i(t)}{dt} \approx r_i
\]</span></p>
<p>That is, the species will establish if it has a positive growth rate in the new environment. Suppose that this is the case: then species <span class="math inline">\(i\)</span> will grow to its equilibrium abundance <span class="math inline">\(x_i^\star = -r_i / A_{ii}\)</span>. Now add a second species. Its initial per-capita growth rate is going to be:</p>
<p><span class="math display">\[
\dfrac{1}{x_j(t)}\dfrac{dx_j(t)}{dt} = r_j + \sum_k A_{jk} x_k(t) \approx r_j + A_{ji}x_i^\star
\]</span></p>
<p>Species <span class="math inline">\(j\)</span> can therefore growth when rare if <span class="math inline">\(r_j + A_{ji}x_i^\star &gt; 0\)</span>, i.e., <span class="math inline">\(r_j &gt; -A_{ji}x_i^\star\)</span>. We call this type of inequality an <strong>“invasion criterion”</strong>.</p>
<p>If the species <span class="math inline">\(j\)</span> can grow when rare, in general, it could a) grow initially, but then go extinct; b) displace species <span class="math inline">\(i\)</span>, sending it to extinction; c) coexist with species <span class="math inline">\(i\)</span>. By reiterating invasions with different species, we can assemble a large ecological community.</p>
</div>
<div id="invasion-in-multispecies-communities" class="section level2">
<h2><span class="header-section-number">3.2</span> Invasion in multispecies communities</h2>
<p>Now consider a pool of species (e.g., a metacommunity) and an environment (e.g., an island) in which some of the species are present, and coexisting at an equilibrium. We have <span class="math inline">\(n\)</span> species in the pool, and <span class="math inline">\(k\)</span> species in the environment. We want to write conditions for the invasibility of the equilibrium. To this end, we can re-arrange the rows and columns of <span class="math inline">\(A\)</span>, and the elements of <span class="math inline">\(r\)</span> to obtain two blocks: one for the <span class="math inline">\(k\)</span> species already in the community, and one for the <span class="math inline">\(n-k\)</span> potential invaders.</p>
<p>The fixed point <span class="math inline">\(\bar{x}\)</span> can be written as
<span class="math display">\[
\bar{x} = \left(\begin{array}{l}
x^{(k)} \\
0^{(n-k)} 
\end{array} \right)
\]</span>
where <span class="math inline">\(x^{(k)}\)</span> contains the density of the coexisting species. Similarly, the growth rates are</p>
<p><span class="math display">\[
r = \left(\begin{array}{l}
r^{(k)} \\
r^{(n-k)} 
\end{array} \right)
\]</span>
and the interaction matrix</p>
<p><span class="math display">\[
A = \begin{pmatrix}
A^{(k,k)} &amp; A^{(k, n- k)}\\
A^{(n-k,k)} &amp; A^{(n-k, n- k)}\\
  \end{pmatrix}
\]</span>
where each block <span class="math inline">\(A^{(a,b)}\)</span> contains the effects of the species in set <span class="math inline">\(b\)</span> on the growth of the species in <span class="math inline">\(a\)</span>. For feasibility we need:</p>
<p><span class="math display">\[
x^{(k)} = -r^{(k)}\left(A^{(k,k)} \right)^{-1} &gt; 0
\]</span>
Now we want to write the condition for the non-invasibility of the resident community by the other species in the metacommunity. For each species in <span class="math inline">\((n-k)\)</span>, we need to have a negative growth rate when invading:</p>
<p><span class="math display">\[
r^{(n-k)} + A^{(n-k,k)}x^{(k)} &lt; 0
\]</span></p>
<p>an equilibrium <span class="math inline">\(\bar{x}\)</span> for which a) the <span class="math inline">\(x^{(k)}\)</span> is feasible and stable (when considering only the species in <span class="math inline">\(k\)</span>) and b) no other species can invade when rare is called the <strong>feasible, stable, non-invasible solution</strong> or the <strong>saturated equilibrium</strong>.</p>
</div>
<div id="lyapunov-stability-and-saturated-equilibria" class="section level2">
<h2><span class="header-section-number">3.3</span> Lyapunov stability and saturated equilibria</h2>
<p>We have seen in the previous lecture that whenever there exists a matrix <span class="math inline">\(C\)</span> such that <span class="math inline">\(CA + A^t C\)</span> is negative definite and we have a feasible equilibrium <span class="math inline">\(x^\star\)</span> then the equilibrium is globally stable. Now we consider the case in which a feasible equilibrium does not exist. However, we can prove that a <strong>saturated equilibrium</strong> exists and is unique: we have an equilibrium <span class="math inline">\(\bar{x}\)</span> in which some components are positive and some are zero such that <span class="math inline">\(k\)</span> species coexist at a globally stable equilibrium, and the remaining <span class="math inline">\((n-k)\)</span> species cannot invade it.</p>
<p>Following <span class="citation">Hofbauer and Sigmund (<a href="#ref-hofbauer1998evolutionary" role="doc-biblioref">1998</a>)</span> (section 15.3), we write:</p>
<p><span class="math display">\[
V(x) = -\sum_i c_i (\bar{x}_i \log x_i - x_i)
\]</span>
yielding:</p>
<p><span class="math display">\[
\begin{aligned}
\dfrac{V(x)}{dt} &amp;= -\sum_i c_i \left(\bar{x}_i \frac{d \log x_i}{dt} - \frac{d x_i}{dt} \right) \\
&amp;= -\sum_i c_i \left( \bar{x}_i - x_i \right)  \left( r_i + \sum_j A_{ij} x_j \right) \\
&amp;= -\sum_i c_i \left( \bar{x}_i - x_i \right)  \left( r_i + \sum_j A_{ij} (x_j - \bar{x}_j) +  \sum_j A_{ij} \bar{x}_j \right) \\
&amp;= \sum_{i,j} \left( \bar{x}_i - x_i \right) c_i A_{ij} \left( \bar{x}_j - x_j \right) - \sum_i c_i \left( \bar{x}_i - x_i \right) \left(r_i + \sum_j A_{ij} \bar{x}_j \right)
\end{aligned}
\]</span></p>
<p>The first term is negative for all <span class="math inline">\(x \neq \bar{x}\)</span>, and is zero at the saturated equilibrium point. The second term is zero for all <span class="math inline">\(\bar{x}_i &gt; 0\)</span>: <span class="math inline">\(r_i + \sum_j A_{ij} \bar{x}_j = 0\)</span>, given that <span class="math inline">\(\bar{x}\)</span> is an equilibrium for the species at positive density; for the remaining species (for which <span class="math inline">\(\bar{x}_i = 0\)</span>), this amounts to the invasion criterion above, and must therefore be negative. As such <span class="math inline">\(V(x)\)</span> is a Lyapunov function for the system, assuming negative values everywhere but at <span class="math inline">\(\bar{x}\)</span>.</p>
</div>
<div id="how-many-species-will-coexist" class="section level2">
<h2><span class="header-section-number">3.4</span> How many species will coexist?</h2>
<p>Here we investigate the simplest case in which <span class="math inline">\(A\)</span> is symmetric and stable (and therefore Lyapunov Diagonally stable) matrix with random coefficients, and <span class="math inline">\(r\)</span> is a vector of growth rates with random coefficients. For simplicity, we take the off-diagonal elements of <span class="math inline">\(A\)</span> and the growth rates from a normal distribution centered at zero (the same would be found for any distribution symmetric about zero). This case was studied by <span class="citation">Serván et al. (<a href="#ref-servan2018coexistence" role="doc-biblioref">2018</a>)</span>.</p>
<p>First, we are going to consider a trivial case, then simulate a more complex one, and finally outline the proof in <span class="citation">Serván et al. (<a href="#ref-servan2018coexistence" role="doc-biblioref">2018</a>)</span>.</p>
<div id="a-trivial-case" class="section level3">
<h3><span class="header-section-number">3.4.1</span> A trivial case</h3>
<p>Suppose that the growth rates are drawn from a normal distribution centered at zero, and that the matrix <span class="math inline">\(A\)</span> is diagonal and stable (i.e., species do not interact with each other; each species is self regulating). As such, a species will persist if and only if <span class="math inline">\(r_i &gt; 0\)</span>. If we draw the growth rates from any distribution centered at zero, then the probability of having a positive growth rate is <span class="math inline">\(1/2\)</span>. Therefore, the number of coexisting species will follow the binomial distribution with parameters <span class="math inline">\(n\)</span> and <span class="math inline">\(1/2\)</span>.</p>
</div>
<div id="simulating-final-composition" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Simulating final composition</h3>
<p>Now, let’s simulate cases in which species do interact with each other. First, we load the functions we’ve written before:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="multi.html#cb25-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb25-2"><a href="multi.html#cb25-2"></a><span class="kw">library</span>(deSolve)</span>
<span id="cb25-3"><a href="multi.html#cb25-3"></a><span class="co"># Generalized Lotka-Volterra model</span></span>
<span id="cb25-4"><a href="multi.html#cb25-4"></a>GLV &lt;-<span class="st"> </span><span class="cf">function</span>(t, x, parameters){</span>
<span id="cb25-5"><a href="multi.html#cb25-5"></a>  <span class="kw">with</span>(<span class="kw">as.list</span>(<span class="kw">c</span>(x, parameters)), {</span>
<span id="cb25-6"><a href="multi.html#cb25-6"></a>    x[x <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span><span class="op">^-</span><span class="dv">8</span>] &lt;-<span class="st"> </span><span class="dv">0</span> <span class="co"># prevent numerical problems</span></span>
<span id="cb25-7"><a href="multi.html#cb25-7"></a>    dxdt &lt;-<span class="st"> </span>x <span class="op">*</span><span class="st"> </span>(r <span class="op">+</span><span class="st"> </span>A <span class="op">%*%</span><span class="st"> </span>x)</span>
<span id="cb25-8"><a href="multi.html#cb25-8"></a>    <span class="kw">list</span>(dxdt)</span>
<span id="cb25-9"><a href="multi.html#cb25-9"></a>  })</span>
<span id="cb25-10"><a href="multi.html#cb25-10"></a>}</span>
<span id="cb25-11"><a href="multi.html#cb25-11"></a><span class="co"># function to plot output</span></span>
<span id="cb25-12"><a href="multi.html#cb25-12"></a>plot_ODE_output &lt;-<span class="st"> </span><span class="cf">function</span>(out){</span>
<span id="cb25-13"><a href="multi.html#cb25-13"></a>  out &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(out)</span>
<span id="cb25-14"><a href="multi.html#cb25-14"></a>  <span class="kw">colnames</span>(out) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;time&quot;</span>, <span class="kw">paste</span>(<span class="st">&quot;sp&quot;</span>, <span class="dv">1</span><span class="op">:</span>(<span class="kw">ncol</span>(out) <span class="dv">-1</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb25-15"><a href="multi.html#cb25-15"></a>  out &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(out) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(species, density, <span class="op">-</span>time)</span>
<span id="cb25-16"><a href="multi.html#cb25-16"></a>  pl &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> out) <span class="op">+</span><span class="st"> </span></span>
<span id="cb25-17"><a href="multi.html#cb25-17"></a><span class="st">    </span><span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> density, <span class="dt">colour =</span> species) <span class="op">+</span><span class="st"> </span></span>
<span id="cb25-18"><a href="multi.html#cb25-18"></a><span class="st">    </span><span class="kw">geom_line</span>()</span>
<span id="cb25-19"><a href="multi.html#cb25-19"></a>  <span class="kw">show</span>(pl)</span>
<span id="cb25-20"><a href="multi.html#cb25-20"></a>  <span class="kw">return</span>(out)</span>
<span id="cb25-21"><a href="multi.html#cb25-21"></a>}</span>
<span id="cb25-22"><a href="multi.html#cb25-22"></a><span class="co"># general function to integrate GLV</span></span>
<span id="cb25-23"><a href="multi.html#cb25-23"></a>integrate_GLV &lt;-<span class="st"> </span><span class="cf">function</span>(r, A, x0, <span class="dt">maxtime =</span> <span class="dv">100</span>, <span class="dt">steptime =</span> <span class="fl">0.5</span>){</span>
<span id="cb25-24"><a href="multi.html#cb25-24"></a>  times &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, maxtime, <span class="dt">by =</span> steptime)</span>
<span id="cb25-25"><a href="multi.html#cb25-25"></a>  parameters &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">r =</span> r, <span class="dt">A =</span> A)</span>
<span id="cb25-26"><a href="multi.html#cb25-26"></a>  <span class="co"># solve numerically</span></span>
<span id="cb25-27"><a href="multi.html#cb25-27"></a>  out &lt;-<span class="st"> </span><span class="kw">ode</span>(<span class="dt">y =</span> x0, <span class="dt">times =</span> times, </span>
<span id="cb25-28"><a href="multi.html#cb25-28"></a>           <span class="dt">func =</span> GLV, <span class="dt">parms =</span> parameters, </span>
<span id="cb25-29"><a href="multi.html#cb25-29"></a>           <span class="dt">method =</span> <span class="st">&quot;ode45&quot;</span>)</span>
<span id="cb25-30"><a href="multi.html#cb25-30"></a>  <span class="co"># plot and make into tidy form</span></span>
<span id="cb25-31"><a href="multi.html#cb25-31"></a>  out &lt;-<span class="st"> </span><span class="kw">plot_ODE_output</span>(out)</span>
<span id="cb25-32"><a href="multi.html#cb25-32"></a>  <span class="kw">return</span>(out)</span>
<span id="cb25-33"><a href="multi.html#cb25-33"></a>}</span></code></pre></div>
<p>And then write functions to give us a (barely) stable, symmetric matrix <span class="math inline">\(A\)</span>, and random growth rates:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="multi.html#cb26-1"></a><span class="co"># function to build symmetric, Lyapunov Diagonally-stable matrix</span></span>
<span id="cb26-2"><a href="multi.html#cb26-2"></a>build_LDstable &lt;-<span class="st"> </span><span class="cf">function</span>(n){</span>
<span id="cb26-3"><a href="multi.html#cb26-3"></a>  A &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, n, n)</span>
<span id="cb26-4"><a href="multi.html#cb26-4"></a>  A[<span class="kw">upper.tri</span>(A)] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n <span class="op">*</span><span class="st"> </span>(n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)</span>
<span id="cb26-5"><a href="multi.html#cb26-5"></a>  <span class="co"># make symmetric</span></span>
<span id="cb26-6"><a href="multi.html#cb26-6"></a>  A &lt;-<span class="st"> </span>A <span class="op">+</span><span class="st"> </span><span class="kw">t</span>(A)</span>
<span id="cb26-7"><a href="multi.html#cb26-7"></a>  <span class="co"># now find the largest eigenvalue</span></span>
<span id="cb26-8"><a href="multi.html#cb26-8"></a>  l1A &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">eigen</span>(A, <span class="dt">only.values =</span> <span class="ot">TRUE</span>, <span class="dt">symmetric =</span> <span class="ot">TRUE</span>)<span class="op">$</span>values)</span>
<span id="cb26-9"><a href="multi.html#cb26-9"></a>  <span class="cf">if</span> (l1A <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>){</span>
<span id="cb26-10"><a href="multi.html#cb26-10"></a>    <span class="co"># set the diagonal to make it stable</span></span>
<span id="cb26-11"><a href="multi.html#cb26-11"></a>    <span class="kw">diag</span>(A) &lt;-<span class="st"> </span><span class="kw">diag</span>(A) <span class="op">-</span><span class="st"> </span>l1A <span class="op">-</span><span class="st"> </span><span class="fl">0.01</span></span>
<span id="cb26-12"><a href="multi.html#cb26-12"></a>  }</span>
<span id="cb26-13"><a href="multi.html#cb26-13"></a>  <span class="kw">return</span>(A)</span>
<span id="cb26-14"><a href="multi.html#cb26-14"></a>}</span>
<span id="cb26-15"><a href="multi.html#cb26-15"></a></span>
<span id="cb26-16"><a href="multi.html#cb26-16"></a><span class="co"># function to get random growth rates</span></span>
<span id="cb26-17"><a href="multi.html#cb26-17"></a>build_randomr &lt;-<span class="st"> </span><span class="cf">function</span>(n){</span>
<span id="cb26-18"><a href="multi.html#cb26-18"></a>  <span class="kw">return</span>(<span class="kw">rnorm</span>(n))</span>
<span id="cb26-19"><a href="multi.html#cb26-19"></a>}</span></code></pre></div>
<p>Now, we build a random system with seven species, and integrate the dynamics:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="multi.html#cb27-1"></a><span class="kw">set.seed</span>(<span class="dv">5</span>) <span class="co"># for reproducibility</span></span>
<span id="cb27-2"><a href="multi.html#cb27-2"></a>n &lt;-<span class="st"> </span><span class="dv">7</span></span>
<span id="cb27-3"><a href="multi.html#cb27-3"></a>A &lt;-<span class="st"> </span><span class="kw">build_LDstable</span>(n)</span>
<span id="cb27-4"><a href="multi.html#cb27-4"></a>r &lt;-<span class="st"> </span><span class="kw">build_randomr</span>(n)</span>
<span id="cb27-5"><a href="multi.html#cb27-5"></a>x0 &lt;-<span class="st"> </span><span class="kw">runif</span>(n)</span>
<span id="cb27-6"><a href="multi.html#cb27-6"></a>out &lt;-<span class="st"> </span><span class="kw">integrate_GLV</span>(r, A, x0)</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/rndzooex1-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="multi.html#cb28-1"></a>out <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb28-2"><a href="multi.html#cb28-2"></a><span class="st">  </span><span class="kw">filter</span>(out<span class="op">$</span>time <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(out<span class="op">$</span>time)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb28-3"><a href="multi.html#cb28-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">ifelse</span>(density <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span><span class="op">^-</span><span class="dv">6</span>, <span class="dv">0</span>, density))</span></code></pre></div>
<pre><code># # A tibble: 7 x 3
#    time species density
#   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
# 1   100 sp_1      0.429
# 2   100 sp_2      0.276
# 3   100 sp_3      0    
# 4   100 sp_4      0.402
# 5   100 sp_5      0    
# 6   100 sp_6      0.645
# 7   100 sp_7      0.578</code></pre>
<p>As you can see, in this case, two species (3 and 5) go extinct, while the other ones reach a feasible equilibrium. Let’s try to start the system with species 3 and 5 at high abundance, to show that the equilibrium is indeed globally stable:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="multi.html#cb30-1"></a>x0[<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb30-2"><a href="multi.html#cb30-2"></a>x0[<span class="dv">5</span>] &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb30-3"><a href="multi.html#cb30-3"></a>out &lt;-<span class="st"> </span><span class="kw">integrate_GLV</span>(r, A, x0)</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/rndzooex2-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="multi.html#cb31-1"></a>out <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb31-2"><a href="multi.html#cb31-2"></a><span class="st">  </span><span class="kw">filter</span>(out<span class="op">$</span>time <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(out<span class="op">$</span>time)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb31-3"><a href="multi.html#cb31-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">ifelse</span>(density <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span><span class="op">^-</span><span class="dv">6</span>, <span class="dv">0</span>, density))</span></code></pre></div>
<pre><code># # A tibble: 7 x 3
#    time species density
#   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
# 1   100 sp_1      0.429
# 2   100 sp_2      0.276
# 3   100 sp_3      0    
# 4   100 sp_4      0.402
# 5   100 sp_5      0    
# 6   100 sp_6      0.645
# 7   100 sp_7      0.578</code></pre>
<p>As you can see, the system still goes to the same equilibrium, with 3 and 5 extinct. Turns out, for this type of system, one does not even need to integrate dynamics: the Lemke–Howson algorithm can be adapted to solve the problem efficiently <span class="citation">(Serván et al. <a href="#ref-servan2018coexistence" role="doc-biblioref">2018</a>)</span>. I have coded up the algorithm already, and you can load the function <code>get_final_composition(A, r)</code> by typing:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="multi.html#cb33-1"></a><span class="kw">source</span>(<span class="st">&quot;https://raw.githubusercontent.com/StefanoAllesina/Sao_Paulo_School/master/code/L-H.R&quot;</span>)</span>
<span id="cb33-2"><a href="multi.html#cb33-2"></a><span class="kw">get_final_composition</span>(A, r) <span class="co"># use LH instead of integrating dynamics</span></span></code></pre></div>
<pre><code># [1] 0.4290300 0.2761030 0.0000000 0.4021761 0.0000000 0.6453202 0.5776840</code></pre>
</div>
</div>
<div id="a-random-zoo" class="section level2">
<h2><span class="header-section-number">3.5</span> A random zoo</h2>
<p>In the case above, 5 species persisted. We can ask how many species will coexist in general under this parametrization. A good metaphor is that of the random zoo: take a large zoo, open all the cages, and return after fifty years. How many species will you find?</p>
<p>To simulate the random zoo, we take random matrices and random growth rates with <span class="math inline">\(n\)</span> species, and tally the number of coexisting species over several simulations:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="multi.html#cb35-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb35-2"><a href="multi.html#cb35-2"></a>n &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb35-3"><a href="multi.html#cb35-3"></a>nsim &lt;-<span class="st"> </span><span class="dv">2000</span></span>
<span id="cb35-4"><a href="multi.html#cb35-4"></a>results &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">simulation =</span> <span class="dv">1</span><span class="op">:</span>nsim, <span class="dt">ncoexisting =</span> <span class="kw">rep</span>(<span class="ot">NA</span>, nsim))</span>
<span id="cb35-5"><a href="multi.html#cb35-5"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nsim){</span>
<span id="cb35-6"><a href="multi.html#cb35-6"></a>  <span class="co"># build the matrix and vector</span></span>
<span id="cb35-7"><a href="multi.html#cb35-7"></a>  A &lt;-<span class="st"> </span><span class="kw">build_LDstable</span>(n)</span>
<span id="cb35-8"><a href="multi.html#cb35-8"></a>  r &lt;-<span class="st"> </span><span class="kw">build_randomr</span>(n)</span>
<span id="cb35-9"><a href="multi.html#cb35-9"></a>  xstar &lt;-<span class="st"> </span><span class="kw">get_final_composition</span>(A, r)</span>
<span id="cb35-10"><a href="multi.html#cb35-10"></a>  results<span class="op">$</span>ncoexisting[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(xstar <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb35-11"><a href="multi.html#cb35-11"></a>}</span>
<span id="cb35-12"><a href="multi.html#cb35-12"></a>pl &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> results) <span class="op">+</span><span class="st"> </span></span>
<span id="cb35-13"><a href="multi.html#cb35-13"></a><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> ncoexisting) <span class="op">+</span><span class="st"> </span></span>
<span id="cb35-14"><a href="multi.html#cb35-14"></a><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb35-15"><a href="multi.html#cb35-15"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;number of species coexisting&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb35-16"><a href="multi.html#cb35-16"></a><span class="kw">show</span>(pl)</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/randomzoo-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="multi.html#cb36-1"></a><span class="co"># add binomial distribution</span></span>
<span id="cb36-2"><a href="multi.html#cb36-2"></a>tbinom &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">ncoexisting =</span> <span class="dv">0</span><span class="op">:</span>n, </span>
<span id="cb36-3"><a href="multi.html#cb36-3"></a>                 <span class="dt">expectation =</span> nsim <span class="op">*</span><span class="st"> </span><span class="kw">dbinom</span>(<span class="dv">0</span><span class="op">:</span>n, n, <span class="fl">0.5</span>))</span>
<span id="cb36-4"><a href="multi.html#cb36-4"></a>pl &lt;-<span class="st"> </span>pl <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">data =</span> tbinom, <span class="kw">aes</span>(<span class="dt">x =</span> ncoexisting, <span class="dt">y =</span> expectation))</span>
<span id="cb36-5"><a href="multi.html#cb36-5"></a><span class="kw">show</span>(pl)</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/randomzoo-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>We find again that the number of coexisting species follows the binomial distribution with parameters <span class="math inline">\(n\)</span> and <span class="math inline">\(1/2\)</span> (i.e., exactly the same result found for non interacting species). To prove this fact, let’s begin with showing that the probability of having all species coexisting is <span class="math inline">\(1 / 2^n\)</span>. For this, we need <span class="math inline">\(x^\star = -r A^{-1}\)</span> to be feasible. For each possible <span class="math inline">\(A\)</span> (invertible) and <span class="math inline">\(r\)</span>, we have that the vector <span class="math inline">\(-r A^{-1}\)</span> will display a certain pattern of signs. Proving that the probability that all <span class="math inline">\(n\)</span> species coexist is <span class="math inline">\(1 / 2^n\)</span> amounts to proving that all sign patterns are equally probable. To this end, define the matrix <span class="math inline">\(D_k = (-1)^{\delta_{ik}} \delta_{ij}\)</span>. This is like the identity matrix, but with element <span class="math inline">\(k\)</span> of the diagonal set to <span class="math inline">\(-1\)</span> instead of <span class="math inline">\(1\)</span>. We have that:</p>
<p><span class="math display">\[
(D_k A D_k) D_k x^\star = -D_k r
\]</span></p>
<p>That is, by setting the <span class="math inline">\(k^\text{th}\)</span> element of <span class="math inline">\(D_k\)</span> to -1, we flip the sign of the <span class="math inline">\(k^\text{th}\)</span> component of <span class="math inline">\(x^\star\)</span>. For example:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="multi.html#cb37-1"></a><span class="kw">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb37-2"><a href="multi.html#cb37-2"></a>A &lt;-<span class="st"> </span><span class="kw">build_LDstable</span>(<span class="dv">3</span>)</span>
<span id="cb37-3"><a href="multi.html#cb37-3"></a>r &lt;-<span class="st"> </span><span class="kw">build_randomr</span>(<span class="dv">3</span>)</span>
<span id="cb37-4"><a href="multi.html#cb37-4"></a><span class="co"># the equilibrium is not feasible</span></span>
<span id="cb37-5"><a href="multi.html#cb37-5"></a><span class="kw">solve</span>(A, <span class="op">-</span>r)</span>
<span id="cb37-6"><a href="multi.html#cb37-6"></a><span class="co"># build matrix D_1</span></span>
<span id="cb37-7"><a href="multi.html#cb37-7"></a>D_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">diag</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb37-8"><a href="multi.html#cb37-8"></a><span class="co"># the multiplication changes the sign of a component of the solution</span></span>
<span id="cb37-9"><a href="multi.html#cb37-9"></a><span class="co"># making the equilibrium feasible</span></span>
<span id="cb37-10"><a href="multi.html#cb37-10"></a><span class="kw">solve</span>(D_<span class="dv">1</span> <span class="op">%*%</span><span class="st"> </span>A <span class="op">%*%</span><span class="st"> </span>D_<span class="dv">1</span>, <span class="op">-</span>D_<span class="dv">1</span> <span class="op">%*%</span><span class="st"> </span>r)</span></code></pre></div>
<pre><code># [1] -11.75292  26.47508  22.73981
#          [,1]
# [1,] 11.75292
# [2,] 26.47508
# [3,] 22.73981</code></pre>
<p>Because of the symmetry assumption (i.e., we sampled all growth rates and off-diagonal elements from a distribution centered at zero), <span class="math inline">\((D_k A D_k)\)</span> has the same distribution as <span class="math inline">\(A\)</span>, and <span class="math inline">\(D_k r\)</span> the same distribution as <span class="math inline">\(r\)</span>. We can repeat the operation several times, connecting each possible starting point to the feasible solution. Therefore, the probability of all species coexisting amounts to the probability of having chosen the “right” sequence of <span class="math inline">\(D_k\)</span>, which happens with probability <span class="math inline">\(1 / 2^n\)</span>. Notice that the same proof holds when the coefficients of <span class="math inline">\(A\)</span> are sampled in pairs from a bivariate distribution (rather than having symmetric matrices), as long as the distribution is centered at zero, and the matrix is <span class="math inline">\(D-\)</span>stable (<span class="citation">Serván et al. (<a href="#ref-servan2018coexistence" role="doc-biblioref">2018</a>)</span>). Using the same argument, one can prove that, under this parametrization, the probability of observing <span class="math inline">\(k\)</span> species coexisting and <span class="math inline">\(n -k\)</span> not being able to invade is exactly <span class="math inline">\(\binom{n}{k} \frac{1}{2^n}\)</span> (<span class="citation">Serván et al. (<a href="#ref-servan2018coexistence" role="doc-biblioref">2018</a>)</span>).</p>
</div>
<div id="assembly-and-saturated-equilibrium" class="section level2">
<h2><span class="header-section-number">3.6</span> Assembly and saturated equilibrium</h2>
<p>Now let’s make it more complicated: we assemble an ecological community from the ground up. At each step, we introduce a species at low abundance, starting from an empty community. We then compute the new equilibrium, completing a step of the assembly:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="multi.html#cb39-1"></a>assembly_one_step &lt;-<span class="st"> </span><span class="cf">function</span>(x, r, A){</span>
<span id="cb39-2"><a href="multi.html#cb39-2"></a>  n &lt;-<span class="st"> </span><span class="kw">nrow</span>(A)</span>
<span id="cb39-3"><a href="multi.html#cb39-3"></a>  invader &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>n, <span class="dv">1</span>)</span>
<span id="cb39-4"><a href="multi.html#cb39-4"></a>  x[invader] &lt;-<span class="st"> </span><span class="fl">0.001</span> <span class="co"># introduce the invader at low abundance</span></span>
<span id="cb39-5"><a href="multi.html#cb39-5"></a>  present &lt;-<span class="st"> </span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="co"># these are the species present now</span></span>
<span id="cb39-6"><a href="multi.html#cb39-6"></a>  <span class="co"># compute new equilibrium</span></span>
<span id="cb39-7"><a href="multi.html#cb39-7"></a>  y &lt;-<span class="st"> </span><span class="kw">get_final_composition</span>(A[present, present, <span class="dt">drop =</span> <span class="ot">FALSE</span>], r[present])</span>
<span id="cb39-8"><a href="multi.html#cb39-8"></a>  x[present] &lt;-<span class="st"> </span>y</span>
<span id="cb39-9"><a href="multi.html#cb39-9"></a>  <span class="kw">return</span>(x)</span>
<span id="cb39-10"><a href="multi.html#cb39-10"></a>}</span></code></pre></div>
<p>Now we can take a species pool along with their parameters, and try to assemble the system until we can no longer add any more species (i.e., until we reach a saturated equilibrium):</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="multi.html#cb40-1"></a><span class="kw">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb40-2"><a href="multi.html#cb40-2"></a>n &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb40-3"><a href="multi.html#cb40-3"></a>A &lt;-<span class="st"> </span><span class="kw">build_LDstable</span>(n)</span>
<span id="cb40-4"><a href="multi.html#cb40-4"></a>r &lt;-<span class="st"> </span><span class="kw">build_randomr</span>(n)</span>
<span id="cb40-5"><a href="multi.html#cb40-5"></a><span class="co"># start with no species</span></span>
<span id="cb40-6"><a href="multi.html#cb40-6"></a>x &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, n)</span>
<span id="cb40-7"><a href="multi.html#cb40-7"></a><span class="co"># assemble for 40 steps and keep track of richness and composition</span></span>
<span id="cb40-8"><a href="multi.html#cb40-8"></a>ninvasions &lt;-<span class="st"> </span><span class="dv">40</span></span>
<span id="cb40-9"><a href="multi.html#cb40-9"></a>results &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">invasion =</span> <span class="dv">1</span><span class="op">:</span>ninvasions, </span>
<span id="cb40-10"><a href="multi.html#cb40-10"></a>                  <span class="dt">richness =</span> <span class="kw">rep</span>(<span class="ot">NA</span>, ninvasions),</span>
<span id="cb40-11"><a href="multi.html#cb40-11"></a>                  <span class="dt">composition =</span> <span class="kw">rep</span>(<span class="ot">NA</span>, ninvasions))</span>
<span id="cb40-12"><a href="multi.html#cb40-12"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>ninvasions){</span>
<span id="cb40-13"><a href="multi.html#cb40-13"></a>  x &lt;-<span class="st"> </span><span class="kw">assembly_one_step</span>(x, r, A) </span>
<span id="cb40-14"><a href="multi.html#cb40-14"></a>  results<span class="op">$</span>richness[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb40-15"><a href="multi.html#cb40-15"></a>  results<span class="op">$</span>composition[i] &lt;-<span class="st"> </span><span class="kw">paste</span>((<span class="dv">1</span><span class="op">:</span>n)[x<span class="op">&gt;</span><span class="dv">0</span>], <span class="dt">collapse =</span> <span class="st">&quot;-&quot;</span>)</span>
<span id="cb40-16"><a href="multi.html#cb40-16"></a>}</span>
<span id="cb40-17"><a href="multi.html#cb40-17"></a><span class="kw">print</span>(<span class="kw">head</span>(results))</span>
<span id="cb40-18"><a href="multi.html#cb40-18"></a>pl &lt;-<span class="st"> </span><span class="kw">ggplot</span>(results) <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> invasion, <span class="dt">y =</span> richness, <span class="dt">label =</span> composition) <span class="op">+</span><span class="st"> </span></span>
<span id="cb40-19"><a href="multi.html#cb40-19"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">nudge_y =</span> <span class="fl">0.25</span>, <span class="dt">angle =</span> <span class="dv">90</span>)<span class="op">+</span><span class="st"> </span></span>
<span id="cb40-20"><a href="multi.html#cb40-20"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>, n <span class="op">*</span><span class="st"> </span><span class="fl">1.25</span>))</span>
<span id="cb40-21"><a href="multi.html#cb40-21"></a><span class="kw">show</span>(pl)</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/rndzooassembly-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code># # A tibble: 6 x 3
#   invasion richness composition
#      &lt;int&gt;    &lt;int&gt; &lt;chr&gt;      
# 1        1        0 &quot;&quot;         
# 2        2        0 &quot;&quot;         
# 3        3        1 2          
# 4        4        2 1-2        
# 5        5        2 1-2        
# 6        6        2 1-2</code></pre>
<p>Now let’s roll back history and assemble again:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="multi.html#cb42-1"></a><span class="co"># start with no species</span></span>
<span id="cb42-2"><a href="multi.html#cb42-2"></a>x &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, n)</span>
<span id="cb42-3"><a href="multi.html#cb42-3"></a><span class="co"># assemble for 40 steps and keep track of richness</span></span>
<span id="cb42-4"><a href="multi.html#cb42-4"></a>ninvasions &lt;-<span class="st"> </span><span class="dv">40</span></span>
<span id="cb42-5"><a href="multi.html#cb42-5"></a>results &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">invasion =</span> <span class="dv">1</span><span class="op">:</span>ninvasions, </span>
<span id="cb42-6"><a href="multi.html#cb42-6"></a>                  <span class="dt">richness =</span> <span class="kw">rep</span>(<span class="ot">NA</span>, ninvasions),</span>
<span id="cb42-7"><a href="multi.html#cb42-7"></a>                  <span class="dt">composition =</span> <span class="kw">rep</span>(<span class="ot">NA</span>, ninvasions))</span>
<span id="cb42-8"><a href="multi.html#cb42-8"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>ninvasions){</span>
<span id="cb42-9"><a href="multi.html#cb42-9"></a>  x &lt;-<span class="st"> </span><span class="kw">assembly_one_step</span>(x, r, A) </span>
<span id="cb42-10"><a href="multi.html#cb42-10"></a>  results<span class="op">$</span>richness[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb42-11"><a href="multi.html#cb42-11"></a>  results<span class="op">$</span>composition[i] &lt;-<span class="st"> </span><span class="kw">paste</span>((<span class="dv">1</span><span class="op">:</span>n)[x<span class="op">&gt;</span><span class="dv">0</span>], <span class="dt">collapse =</span> <span class="st">&quot;-&quot;</span>)</span>
<span id="cb42-12"><a href="multi.html#cb42-12"></a>}</span>
<span id="cb42-13"><a href="multi.html#cb42-13"></a><span class="kw">print</span>(<span class="kw">head</span>(results))</span>
<span id="cb42-14"><a href="multi.html#cb42-14"></a>pl &lt;-<span class="st"> </span><span class="kw">ggplot</span>(results) <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> invasion, <span class="dt">y =</span> richness, <span class="dt">label =</span> composition) <span class="op">+</span><span class="st"> </span></span>
<span id="cb42-15"><a href="multi.html#cb42-15"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">nudge_y =</span> <span class="fl">0.25</span>, <span class="dt">angle =</span> <span class="dv">90</span>)<span class="op">+</span><span class="st"> </span></span>
<span id="cb42-16"><a href="multi.html#cb42-16"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>, n <span class="op">*</span><span class="st"> </span><span class="fl">1.25</span>))</span>
<span id="cb42-17"><a href="multi.html#cb42-17"></a><span class="kw">show</span>(pl)</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/alternativehistory-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code># # A tibble: 6 x 3
#   invasion richness composition
#      &lt;int&gt;    &lt;int&gt; &lt;chr&gt;      
# 1        1        1 4          
# 2        2        1 4          
# 3        3        1 4          
# 4        4        1 4          
# 5        5        2 4-10       
# 6        6        2 4-10</code></pre>
<p>As you can see, despite taking a different assembly history, we reach the same final composition. In fact, this is exactly what we would expect if we were to throw all species in the environment at the same time:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="multi.html#cb44-1"></a><span class="kw">get_final_composition</span>(A, r)</span>
<span id="cb44-2"><a href="multi.html#cb44-2"></a>x</span></code></pre></div>
<pre><code>#  [1] 1.7588344 2.5440743 0.0000000 0.7860178 1.8730535 2.5502055 0.6961259
#  [8] 1.6956878 0.0000000 0.0000000
#  [1] 1.7588344 2.5440743 0.0000000 0.7860178 1.8730535 2.5502055 0.6961259
#  [8] 1.6956878 0.0000000 0.0000000</code></pre>
<p>As such, given enough time, any assembly history for a symmetric, stable matrix <span class="math inline">\(A\)</span> will eventually reach the final composition represented by the saturated equilibrium (Serván, unpublished).</p>
<p>Interestingly, this is not the case when the matrix is not symmetric. <span class="citation">Serván et al. (<a href="#ref-servan2018coexistence" role="doc-biblioref">2018</a>)</span> conjectured however that the probability of finding a system whose final composition cannot be assembled one species at a time decreases rapidly with the size of the pool, as long as <span class="math inline">\(A\)</span> is Lyapunov Diagonally stable.</p>
</div>
<div id="network-spandrels" class="section level2">
<h2><span class="header-section-number">3.7</span> Network spandrels</h2>
<p>What is the network structure of the assembled community vs. that of the initial pool? Can we detect a signature of the forces acting on the community such that some species can persist, while other go extinct? To answer these questions, we start by considering a larger pool of species:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="multi.html#cb46-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb46-2"><a href="multi.html#cb46-2"></a><span class="co"># initial pool</span></span>
<span id="cb46-3"><a href="multi.html#cb46-3"></a>A &lt;-<span class="st"> </span><span class="kw">build_LDstable</span>(<span class="dv">200</span>)</span>
<span id="cb46-4"><a href="multi.html#cb46-4"></a>r &lt;-<span class="st"> </span><span class="kw">build_randomr</span>(<span class="dv">200</span>)</span>
<span id="cb46-5"><a href="multi.html#cb46-5"></a><span class="co"># final composition</span></span>
<span id="cb46-6"><a href="multi.html#cb46-6"></a>xstar &lt;-<span class="st"> </span><span class="kw">get_final_composition</span>(A, r)</span>
<span id="cb46-7"><a href="multi.html#cb46-7"></a>A_pruned &lt;-<span class="st"> </span>A[xstar <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, xstar <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb46-8"><a href="multi.html#cb46-8"></a>r_pruned &lt;-<span class="st"> </span>r[xstar <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span></code></pre></div>
<p>Are the properties of matrix <span class="math inline">\(A\)</span> different from those of the pruned version <span class="math inline">\(\tilde{A}\)</span>? We probe this in two ways: first, we build a graph with the strongest interactions, and plot it.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="multi.html#cb47-1"></a><span class="kw">library</span>(igraph)</span>
<span id="cb47-2"><a href="multi.html#cb47-2"></a>plot_graph_strong &lt;-<span class="st"> </span><span class="cf">function</span>(B, <span class="dt">quantile =</span> <span class="fl">0.75</span>){</span>
<span id="cb47-3"><a href="multi.html#cb47-3"></a>  Bstrong &lt;-<span class="st"> </span><span class="kw">abs</span>(B)</span>
<span id="cb47-4"><a href="multi.html#cb47-4"></a>  <span class="kw">diag</span>(Bstrong) &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb47-5"><a href="multi.html#cb47-5"></a>  Bstrong[Bstrong <span class="op">&lt;</span><span class="st"> </span><span class="kw">quantile</span>(Bstrong, quantile)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb47-6"><a href="multi.html#cb47-6"></a>  gr &lt;-<span class="st"> </span><span class="kw">graph_from_adjacency_matrix</span>((Bstrong <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">*</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">mode =</span> <span class="st">&quot;undirected&quot;</span>)</span>
<span id="cb47-7"><a href="multi.html#cb47-7"></a>  <span class="kw">plot</span>(gr, <span class="dt">vertex.size=</span><span class="dv">10</span>, <span class="dt">vertex.label=</span><span class="ot">NA</span>, <span class="dt">layout=</span>layout_with_fr)</span>
<span id="cb47-8"><a href="multi.html#cb47-8"></a>}</span>
<span id="cb47-9"><a href="multi.html#cb47-9"></a></span>
<span id="cb47-10"><a href="multi.html#cb47-10"></a><span class="kw">plot_graph_strong</span>(A)</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/plotnetworksrz-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="multi.html#cb48-1"></a><span class="kw">plot_graph_strong</span>(A_pruned)</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/plotnetworksrz-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>There seems to be no special structure. A more powerful way to show the same is to plot the eigenvalues of <span class="math inline">\(A\)</span> and <span class="math inline">\(\tilde{A}\)</span>. For a symmetric matrix with off-diagonal elements centered at zero, the eigenvalues should follow Wigner’s semicircle law:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="multi.html#cb49-1"></a>plot_eigen &lt;-<span class="st"> </span><span class="cf">function</span>(B){</span>
<span id="cb49-2"><a href="multi.html#cb49-2"></a>  evals &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lambda =</span> <span class="kw">eigen</span>(B, <span class="dt">only.values =</span> <span class="ot">TRUE</span>, <span class="dt">symmetric =</span> <span class="ot">TRUE</span>)<span class="op">$</span>values)</span>
<span id="cb49-3"><a href="multi.html#cb49-3"></a>  <span class="kw">ggplot</span>(<span class="dt">data =</span> evals) <span class="op">+</span><span class="st"> </span></span>
<span id="cb49-4"><a href="multi.html#cb49-4"></a><span class="st">    </span><span class="kw">aes</span>(<span class="dt">x =</span> lambda) <span class="op">+</span><span class="st"> </span></span>
<span id="cb49-5"><a href="multi.html#cb49-5"></a><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="kw">as.integer</span>(<span class="kw">nrow</span>(evals) <span class="op">/</span><span class="st"> </span><span class="dv">10</span>), <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb49-6"><a href="multi.html#cb49-6"></a>}</span>
<span id="cb49-7"><a href="multi.html#cb49-7"></a><span class="kw">plot_eigen</span>(A)</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/ploteigenrz-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="multi.html#cb50-1"></a><span class="kw">plot_eigen</span>(A_pruned)</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/ploteigenrz-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>As such, the matrix of interactions before/after dynamics seem to have the same properties. However, as shown in <span class="citation">Serván et al. (<a href="#ref-servan2018coexistence" role="doc-biblioref">2018</a>)</span>, the distribution of the growth rates changes in a non-trivial way:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="multi.html#cb51-1"></a>toplot &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">r =</span> r, <span class="dt">type =</span> <span class="st">&quot;before&quot;</span>)</span>
<span id="cb51-2"><a href="multi.html#cb51-2"></a>toplot &lt;-<span class="st"> </span><span class="kw">rbind</span>(toplot, <span class="kw">data.frame</span>(<span class="dt">r =</span> r_pruned, <span class="dt">type =</span> <span class="st">&quot;after&quot;</span>))</span>
<span id="cb51-3"><a href="multi.html#cb51-3"></a><span class="kw">ggplot</span>(toplot) <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">fill =</span> type) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/plotrbeforeafter-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>But what if species were to be related to each other? For example, suppose <span class="math inline">\(r_i = 1\)</span> for all species, and build a matrix in which the interactions of species <span class="math inline">\(i + 1\)</span> are obtained by mutating slightly those of species <span class="math inline">\(i\)</span>:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="multi.html#cb52-1"></a>n &lt;-<span class="st"> </span><span class="dv">200</span></span>
<span id="cb52-2"><a href="multi.html#cb52-2"></a>r &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">200</span>)</span>
<span id="cb52-3"><a href="multi.html#cb52-3"></a>A &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, n, n)</span>
<span id="cb52-4"><a href="multi.html#cb52-4"></a><span class="co"># set first species</span></span>
<span id="cb52-5"><a href="multi.html#cb52-5"></a>A[<span class="dv">1</span>, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">-1</span></span>
<span id="cb52-6"><a href="multi.html#cb52-6"></a><span class="co"># now each species is obtained by mutating the previous one</span></span>
<span id="cb52-7"><a href="multi.html#cb52-7"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>n){</span>
<span id="cb52-8"><a href="multi.html#cb52-8"></a>  ai &lt;-<span class="st"> </span>A[i <span class="dv">-1</span>,] <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.05</span> <span class="op">*</span><span class="st"> </span><span class="kw">runif</span>(n))</span>
<span id="cb52-9"><a href="multi.html#cb52-9"></a>  A[i, ] &lt;-<span class="st"> </span>A[i, ] <span class="op">+</span><span class="st"> </span>ai</span>
<span id="cb52-10"><a href="multi.html#cb52-10"></a>  A[, i] &lt;-<span class="st"> </span>A[, i] <span class="op">+</span><span class="st"> </span>ai</span>
<span id="cb52-11"><a href="multi.html#cb52-11"></a>  A[i, i] &lt;-<span class="st"> </span><span class="dv">-1</span></span>
<span id="cb52-12"><a href="multi.html#cb52-12"></a>}</span>
<span id="cb52-13"><a href="multi.html#cb52-13"></a><span class="co"># make LD-stable</span></span>
<span id="cb52-14"><a href="multi.html#cb52-14"></a>l1 &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">eigen</span>(A, <span class="dt">only.values =</span> <span class="ot">TRUE</span>, <span class="dt">symmetric =</span> <span class="ot">TRUE</span>)<span class="op">$</span>values)</span>
<span id="cb52-15"><a href="multi.html#cb52-15"></a><span class="cf">if</span> (l1 <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">diag</span>(A) &lt;-<span class="st"> </span><span class="kw">diag</span>(A) <span class="op">-</span><span class="st"> </span>l1 <span class="op">*</span><span class="st"> </span><span class="fl">1.01</span></span></code></pre></div>
<p>Now each species is similar to the previous one:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="multi.html#cb53-1"></a><span class="kw">image</span>(A[<span class="dv">1</span><span class="op">:</span>n, n<span class="op">:</span><span class="dv">1</span>])</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/similarimage-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Perform the pruning, and plot networks and eigenvalues:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="multi.html#cb54-1"></a>xstar &lt;-<span class="st"> </span><span class="kw">get_final_composition</span>(A, r)</span>
<span id="cb54-2"><a href="multi.html#cb54-2"></a>A_pruned &lt;-<span class="st"> </span>A[xstar <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, xstar <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb54-3"><a href="multi.html#cb54-3"></a>r_pruned &lt;-<span class="st"> </span>r[xstar <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb54-4"><a href="multi.html#cb54-4"></a></span>
<span id="cb54-5"><a href="multi.html#cb54-5"></a><span class="kw">plot_graph_strong</span>(A)</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/structruredspandrels-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="multi.html#cb55-1"></a><span class="kw">plot_graph_strong</span>(A_pruned)</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/structruredspandrels-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="multi.html#cb56-1"></a><span class="kw">plot_eigen</span>(A)</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/structruredspandrels-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="multi.html#cb57-1"></a><span class="kw">plot_eigen</span>(A_pruned)</span></code></pre></div>
<p><img src="A-Tour-of-the-Generalized-Lotka-Volterra-Model_files/figure-html/structruredspandrels-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>Meaning that if our matrix <span class="math inline">\(A\)</span> is structured, we will recover a structured matrix after pruning, while if <span class="math inline">\(A\)</span> is unstructured, we will recover an unstructured matrix. <span class="citation">Maynard, Serván, and Allesina (<a href="#ref-maynard2018network" role="doc-biblioref">2018</a>)</span> showed that a well-defined network structure could be a “network spandrel” (cfr. <span class="citation">Gould and Lewontin (<a href="#ref-gould1979spandrels" role="doc-biblioref">1979</a>)</span> and <span class="citation">Solé and Valverde (<a href="#ref-sole2006network" role="doc-biblioref">2006</a>)</span>) arising from the way new species are introduced, rather than a “signature of stability”.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-gould1979spandrels">
<p>Gould, Stephen Jay, and Richard C Lewontin. 1979. “The Spandrels of San Marco and the Panglossian Paradigm: A Critique of the Adaptationist Programme.” <em>Proceedings of the Royal Society of London. Series B. Biological Sciences</em> 205 (1161): 581–98.</p>
</div>
<div id="ref-hofbauer1998evolutionary">
<p>Hofbauer, Josef, and Karl Sigmund. 1998. <em>Evolutionary Games and Population Dynamics</em>. Cambridge university press.</p>
</div>
<div id="ref-maynard2018network">
<p>Maynard, Daniel S, Carlos A Serván, and Stefano Allesina. 2018. “Network Spandrels Reflect Ecological Assembly.” <em>Ecology Letters</em> 21 (3): 324–34.</p>
</div>
<div id="ref-servan2018coexistence">
<p>Serván, Carlos A, José A Capitán, Jacopo Grilli, Kent E Morrison, and Stefano Allesina. 2018. “Coexistence of Many Species in Random Ecosystems.” <em>Nature Ecology &amp; Evolution</em> 2 (8): 1237.</p>
</div>
<div id="ref-sole2006network">
<p>Solé, Ricard V, and Sergi Valverde. 2006. “Are Network Motifs the Spandrels of Cellular Complexity?” <em>Trends in Ecology &amp; Evolution</em> 21 (8): 419–22.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="games.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["A Tour of the Generalized Lotka-Volterra Model.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
